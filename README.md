# Демонстрационная реализация протокола MS-CHAPv2

## 1. Введение
Данный проект представляет собой демонстрационную реализацию протокола аутентификации MS-CHAPv2. Работа включает серверную часть, выполняющую обработку запросов и проверку подлинности пользователей, клиентскую часть, реализованную в браузере, а также базу данных PostgreSQL для хранения учетных записей. Проект разработан в учебных целях и демонстрирует принципы challenge-response аутентификации, характерной для Microsoft CHAP версии 2.

## 2. Назначение и функциональность проекта
Цель проекта — показать процесс проверки подлинности пользователя без передачи пароля по сети. Система реализует следующие функции:
1. Регистрация пользователя с сохранением NT-хеша пароля.
2. Получение клиентом серверного challenge.
3. Генерация клиентом peer_challenge и вычисление NT-Response.
4. Передача NT-Response серверу.
5. Вычисление сервером ожидаемого NT-Response и сравнение его с клиентским.
6. Вывод результата аутентификации.

Проект предназначен для демонстрации криптографических механизмов MS-CHAPv2 и сетевого взаимодействия между клиентом и сервером.

## 3. Архитектура системы

### 3.1. Серверная часть (FastAPI, Python)
Сервер выполняет:
- регистрацию пользователей и сохранение NT-хеша пароля;
- генерацию server challenge;
- проверку NT-Response;
- работу с PostgreSQL через SQLAlchemy.

### 3.2. Клиентская часть (TypeScript, Preact)
Клиентское приложение выполняет:
- ввод логина и пароля пользователем;
- генерацию peer_challenge;
- вычисление NT-Response в браузере;
- отправку данных на сервер;
- визуальный вывод последовательных шагов протокола.

### 3.3. База данных PostgreSQL
Хранит таблицу пользователей. Таблицы создаются автоматически при запуске backend.

### 3.4. Docker Compose
Все части проекта объединены в docker-compose:
- `db` — база данных PostgreSQL;
- `app` — сервер FastAPI;
- `frontend` — клиентское приложение и nginx.

## 4. Как система демонстрирует работу MS-CHAPv2

Проект позволяет проверить корректность работы алгоритма MS-CHAPv2 по шагам благодаря параллельному отображению:

### 4.1. Клиентских вычислений
Браузер выводит:
- peer_challenge;
- server challenge;
- ChallengeHash;
- NT-Response;
- результат вычислений.

### 4.2. Серверных вычислений
В логах backend отображаются:
- auth_challenge;
- полученный клиентский NT-Response;
- вычисленный сервером NT-Response;
- итог сравнения.

### 4.3. Проверка корректности
Реализация считается корректной, если:
- NT-Response клиента и сервера совпадают при правильном пароле;
- NT-Response различаются при неправильном пароле.

Это позволяет однозначно доказать правильность реализации алгоритма.

## 5. Структура проекта

```
backend/
  server.py        — сервер FastAPI
  mschap.py      — реализация MS-CHAPv2
  des.py           — реализация DES
  db.py            — логика работы с PostgreSQL

frontend/
  src/             — клиентская логика (TypeScript)
  index.html
  nginx.conf

docker-compose.yml
README.md
```

## 6. Запуск проекта

### Требования
- Docker
- Docker Compose

### Запуск
```
docker compose up --build
```

После запуска активны сервисы:
- `db`
- `app`
- `client`

### Доступ
Открыть в браузере:
```
http://localhost:8080
```

## 7. Проверка работы

### Регистрация
1. Ввести имя пользователя и пароль.
2. Нажать «Зарегистрировать».

### Аутентификация
1. Ввести логин и пароль.
2. Запустить демонстрацию.
3. Наблюдать:
   - вычисление NT-Response,
   - отправку данных,
   - итог проверки.

### Проверка корректности через логи
Совпадение NT-Response клиента и сервера подтверждает правильность работы алгоритма.

## 8. Пример ручной проверки

```
curl -X POST http://localhost:8000/auth/register   -H "Content-Type: application/json"   -d '{"username":"User","password":"Test123"}'
```

## 9. Заключение
Проект реализует полный рабочий цикл аутентификации MS-CHAPv2 и демонстрирует внутренние этапы протокола. Система позволяет глубоко понять механизм challenge-response и использовать её как учебный материал.
